import{y as _,ae as ue,e as U,g as V,af as F,D as re,j as h,K as C,ag as ve,ah as fe,ai as he,ab as G,a9 as de,aj as ge,ak as me,al as we,C as pe,b as P,G as A,n as K,F as E,am as L,M as q,an as M,p as ye,s as O,i as J,z as be}from"./index.3fe0e41c.js";import{u as Te,a as Q}from"./index.87fb0a01.js";function Me(){const t=_([]),g=[];return ue(()=>{t.value=[]}),[t,o=>(g[o]||(g[o]=r=>{t.value[o]=r}),g[o])]}const[Z,k]=U("swipe"),Se={loop:A,width:K,height:K,vertical:Boolean,autoplay:E(0),duration:E(500),touchable:A,lazyRender:Boolean,initialSwipe:E(0),indicatorColor:String,showIndicators:A,stopPropagation:A},ee=Symbol(Z);var xe=V({name:Z,props:Se,emits:["change"],setup(t,{emit:g,slots:d}){const o=_(),r=_(),e=F({rect:null,width:0,height:0,offset:0,active:0,swiping:!1}),v=Te(),{children:m,linkChildren:I}=re(ee),i=h(()=>m.length),c=h(()=>e[t.vertical?"height":"width"]),l=h(()=>t.vertical?v.deltaY.value:v.deltaX.value),w=h(()=>e.rect?(t.vertical?e.rect.height:e.rect.width)-c.value*i.value:0),R=h(()=>c.value?Math.ceil(Math.abs(w.value)/c.value):i.value),b=h(()=>i.value*c.value),$=h(()=>(e.active+i.value)%i.value),B=h(()=>{const a=t.vertical?"vertical":"horizontal";return v.direction.value===a}),te=h(()=>{const a={transitionDuration:`${e.swiping?0:t.duration}ms`,transform:`translate${t.vertical?"Y":"X"}(${e.offset}px)`};if(c.value){const s=t.vertical?"height":"width",n=t.vertical?"width":"height";a[s]=`${b.value}px`,a[n]=t[n]?`${t[n]}px`:""}return a}),ae=a=>{const{active:s}=e;return a?t.loop?O(s+a,-1,i.value):O(s+a,0,R.value):s},Y=(a,s=0)=>{let n=a*c.value;t.loop||(n=Math.min(n,-w.value));let f=s-n;return t.loop||(f=O(f,w.value,0)),f},p=({pace:a=0,offset:s=0,emitChange:n})=>{if(i.value<=1)return;const{active:f}=e,u=ae(a),x=Y(u,s);if(t.loop){if(m[0]&&x!==w.value){const D=x<w.value;m[0].setOffset(D?b.value:0)}if(m[i.value-1]&&x!==0){const D=x>0;m[i.value-1].setOffset(D?-b.value:0)}}e.active=u,e.offset=x,n&&u!==f&&g("change",$.value)},z=()=>{e.swiping=!0,e.active<=-1?p({pace:i.value}):e.active>=i.value&&p({pace:-i.value})},ie=()=>{z(),v.reset(),M(()=>{e.swiping=!1,p({pace:-1,emitChange:!0})})},X=()=>{z(),v.reset(),M(()=>{e.swiping=!1,p({pace:1,emitChange:!0})})};let H;const T=()=>clearTimeout(H),S=()=>{T(),t.autoplay>0&&i.value>1&&(H=setTimeout(()=>{X(),S()},+t.autoplay))},y=(a=+t.initialSwipe)=>{if(!o.value)return;const s=()=>{var n,f;if(!L(o)){const u={width:o.value.offsetWidth,height:o.value.offsetHeight};e.rect=u,e.width=+((n=t.width)!=null?n:u.width),e.height=+((f=t.height)!=null?f:u.height)}i.value&&(a=Math.min(i.value-1,a)),e.active=a,e.swiping=!0,e.offset=Y(a),m.forEach(u=>{u.setOffset(0)}),S()};L(o)?q().then(s):s()},N=()=>y(e.active);let W;const ne=a=>{!t.touchable||(v.start(a),W=Date.now(),T(),z())},se=a=>{t.touchable&&e.swiping&&(v.move(a),B.value&&(!t.loop&&(e.active===0&&l.value>0||e.active===i.value-1&&l.value<0)||(ye(a,t.stopPropagation),p({offset:l.value}))))},j=()=>{if(!t.touchable||!e.swiping)return;const a=Date.now()-W,s=l.value/a;if((Math.abs(s)>.25||Math.abs(l.value)>c.value/2)&&B.value){const f=t.vertical?v.offsetY.value:v.offsetX.value;let u=0;t.loop?u=f>0?l.value>0?-1:1:0:u=-Math[l.value>0?"ceil":"floor"](l.value/c.value),p({pace:u,emitChange:!0})}else l.value&&p({pace:0});e.swiping=!1,S()},oe=(a,s={})=>{z(),v.reset(),M(()=>{let n;t.loop&&a===i.value?n=e.active===0?0:a:n=a%i.value,s.immediate?M(()=>{e.swiping=!1}):e.swiping=!1,p({pace:n-e.active,emitChange:!0})})},le=(a,s)=>{const n=s===$.value,f=n?{backgroundColor:t.indicatorColor}:void 0;return P("i",{style:f,class:k("indicator",{active:n})},null)},ce=()=>{if(d.indicator)return d.indicator({active:$.value,total:i.value});if(t.showIndicators&&i.value>1)return P("div",{class:k("indicators",{vertical:t.vertical})},[Array(i.value).fill("").map(le)])};return Q({prev:ie,next:X,state:e,resize:N,swipeTo:oe}),I({size:c,props:t,count:i,activeIndicator:$}),C(()=>t.initialSwipe,a=>y(+a)),C(i,()=>y(e.active)),C(()=>t.autoplay,S),C([ve,fe],N),C(he(),a=>{a==="visible"?S():T()}),G(y),de(()=>y(e.active)),ge(()=>y(e.active)),me(T),we(T),pe("touchmove",se,{target:r}),()=>{var a;return P("div",{ref:o,class:k()},[P("div",{ref:r,style:te.value,class:k("track",{vertical:t.vertical}),onTouchstartPassive:ne,onTouchend:j,onTouchcancel:j},[(a=d.default)==null?void 0:a.call(d)]),ce()])}}});const ke=J(xe),[Ce,Pe]=U("swipe-item");var $e=V({name:Ce,setup(t,{slots:g}){let d;const o=F({offset:0,inited:!1,mounted:!1}),{parent:r,index:e}=be(ee);if(!r)return;const v=h(()=>{const i={},{vertical:c}=r.props;return r.size.value&&(i[c?"height":"width"]=`${r.size.value}px`),o.offset&&(i.transform=`translate${c?"Y":"X"}(${o.offset}px)`),i}),m=h(()=>{const{loop:i,lazyRender:c}=r.props;if(!c||d)return!0;if(!o.mounted)return!1;const l=r.activeIndicator.value,w=r.count.value-1,R=l===0&&i?w:l-1,b=l===w&&i?0:l+1;return d=e.value===l||e.value===R||e.value===b,d}),I=i=>{o.offset=i};return G(()=>{q(()=>{o.mounted=!0})}),Q({setOffset:I}),()=>{var i;return P("div",{class:Pe(),style:v.value},[m.value?(i=g.default)==null?void 0:i.call(g):null])}}});const Ie=J($e);export{Ie as S,ke as a,Me as u};
